# YYHertz æ¨¡æ¿å‡½æ•°ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

### åŸå§‹é—®é¢˜
åœ¨ `example/simple` ç›®å½•ä¸‹è¿è¡Œ `main.go` åï¼Œè®¿é—® `/home/routing` è·¯ç”±æ˜¾ç¤ºç©ºç™½é¡µé¢ï¼ŒåŸå› æ˜¯æ¨¡æ¿ä¸­çš„ `{{template "docs-sidebar" .}}` å‡½æ•°ä¸èµ·ä½œç”¨ã€‚

### æ ¹æœ¬åŸå› 
1. **æ¨¡æ¿å¼•æ“é™çº§**: `RenderHTML` æ–¹æ³•åœ¨ `templateEngine` ä¸º `nil` æ—¶é™çº§åˆ° `renderBasicTemplate`
2. **å•æ–‡ä»¶è§£æ**: `renderBasicTemplate` åªè§£æå•ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œä¸æ”¯æŒå­æ¨¡æ¿å¼•ç”¨
3. **å‡½æ•°ç¼ºå¤±**: åŸºç¡€æ¨¡æ¿å¼•æ“ç¼ºå°‘ä¸°å¯Œçš„ Beego é£æ ¼æ¨¡æ¿å‡½æ•°

## ğŸ› ï¸ ä¼˜åŒ–æ–¹æ¡ˆ

### 1. å¢å¼º RenderHTML æ–¹æ³•
```go
// ä¿®æ”¹å‰ï¼šç›´æ¥è°ƒç”¨åŸºç¡€æ¸²æŸ“
c.Render()

// ä¿®æ”¹åï¼šä¼˜å…ˆä½¿ç”¨å¢å¼ºæ¨¡æ¿å¼•æ“
c.initializeEnhancedTemplateEngine()
if c.includeEngine != nil {
    content, err := c.includeEngine.RenderTemplate(viewName, c.Data)
    // æ¸²æŸ“æˆåŠŸåˆ™ç›´æ¥è¾“å‡ºï¼Œå¤±è´¥åˆ™é™çº§
}
```

### 2. è‡ªåŠ¨åˆå§‹åŒ–å¢å¼ºå¼•æ“
```go
func (c *BaseController) initializeEnhancedTemplateEngine() {
    if c.templateEngine == nil {
        cfg := view.DefaultTemplateConfig()
        if c.ViewPath != "" {
            cfg.ViewPaths = []string{c.ViewPath}
        }
        if enhanced, err := view.NewTemplateIncludeEngine(cfg); err == nil {
            c.templateEngine = enhanced.TemplateEngine
            c.includeEngine = enhanced
            c.addBeegoTemplateFunctions() // è‡ªåŠ¨æ·»åŠ å‡½æ•°
        }
    }
}
```

### 3. è‡ªåŠ¨æ·»åŠ  Beego æ¨¡æ¿å‡½æ•°
```go
func (c *BaseController) addBeegoTemplateFunctions() {
    // æ·»åŠ æ‰€æœ‰ Beego é£æ ¼çš„æ¨¡æ¿å‡½æ•°
    for name, fn := range view.BeegoTemplateFuncs {
        c.templateEngine.AddFunction(name, fn)
    }
}
```

## ğŸ¯ æ”¯æŒçš„æ¨¡æ¿å‡½æ•°

### åŸºç¡€å·¥å…·å‡½æ•°
- `str2html` - å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºHTMLå®‰å…¨æ ¼å¼
- `htmlquote` - HTMLè½¬ä¹‰
- `config` - è·å–é…ç½®å€¼
- `urlfor` - ç”ŸæˆURL
- `assets_js` / `assets_css` - åŠ è½½é™æ€èµ„æº

### å­—ç¬¦ä¸²å¤„ç†å‡½æ•°
- `substr` - æˆªå–å­å­—ç¬¦ä¸²: `{{substr "hello" 0 3}}`
- `truncate` - æˆªæ–­å­—ç¬¦ä¸²
- `nl2br` - æ¢è¡Œç¬¦è½¬BRæ ‡ç­¾
- `replace` - å­—ç¬¦ä¸²æ›¿æ¢
- `tolower` / `toupper` - å¤§å°å†™è½¬æ¢
- `trim` - å»é™¤ç©ºç™½

### æ•°å­—è¿ç®—å‡½æ•°
- `add` / `sub` / `mul` / `div` - åŸºç¡€è¿ç®—: `{{add 1 2}}`
- `mod` - å–æ¨¡è¿ç®—
- `round` / `ceil` / `floor` - å–æ•´å‡½æ•°
- `abs` - ç»å¯¹å€¼

### æ¯”è¾ƒå‡½æ•°
- `eq` / `ne` - ç­‰äº/ä¸ç­‰äº: `{{if eq .Status "active"}}`
- `lt` / `le` / `gt` / `ge` - å¤§å°æ¯”è¾ƒ
- `in` - åŒ…å«æ£€æŸ¥

### æ—¥æœŸæ—¶é—´å‡½æ•°
- `dateformat` - æ ¼å¼åŒ–æ—¥æœŸ: `{{dateformat .Time "2006-01-02"}}`
- `timeago` - æ—¶é—´å·®æè¿°: "2å°æ—¶å‰"
- `now` - å½“å‰æ—¶é—´
- `timestamp` - æ—¶é—´æˆ³

### é›†åˆæ“ä½œå‡½æ•°
- `len` - è·å–é•¿åº¦: `{{len .Users}}`
- `index` - è·å–ç´¢å¼•å…ƒç´ 
- `slice` - åˆ‡ç‰‡æ“ä½œ
- `join` / `split` - è¿æ¥/åˆ†å‰²å­—ç¬¦ä¸²
- `reverse` / `sort` - åè½¬/æ’åº

### ç¼–ç è§£ç å‡½æ•°
- `urlencode` / `urldecode` - URLç¼–ç /è§£ç 
- `base64enc` / `base64dec` - Base64ç¼–ç /è§£ç 
- `md5` - MD5å“ˆå¸Œ
- `safejs` / `safehtml` - å®‰å…¨è½¬ä¹‰

### æ¡ä»¶é€»è¾‘å‡½æ•°
- `and` / `or` / `not` - é€»è¾‘è¿ç®—
- `default` - é»˜è®¤å€¼: `{{.Name | default "åŒ¿å"}}`
- `ternary` - ä¸‰å…ƒè¿ç®—

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### æ¨¡æ¿å¼•ç”¨æ”¯æŒ
```html
<!-- ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ -->
<div class="sidebar">
    {{template "docs-sidebar" .}}
</div>

<!-- å­æ¨¡æ¿å®šä¹‰ -->
{{define "docs-sidebar"}}
<div class="nav">...</div>
{{end}}
```

### å‡½æ•°ä½¿ç”¨ç¤ºä¾‹
```html
<!-- å­—ç¬¦ä¸²å¤„ç† -->
<h1>{{.Title | truncate 20}}</h1>
<div>{{.Content | nl2br | str2html}}</div>

<!-- æ•°å­—è¿ç®— -->
<p>æ€»è®¡: {{add .Price .Tax}} å…ƒ</p>
<p>æŠ˜æ‰£: {{mul .Price 0.8}} å…ƒ</p>

<!-- æ—¥æœŸæ ¼å¼åŒ– -->
<time>{{dateformat .CreatedAt "2006-01-02 15:04:05"}}</time>
<span>{{timeago .UpdatedAt}}</span>

<!-- æ¡ä»¶åˆ¤æ–­ -->
{{if eq .Status "published"}}
    <span class="badge-success">å·²å‘å¸ƒ</span>
{{else}}
    <span class="badge-warning">è‰ç¨¿</span>
{{end}}

<!-- é›†åˆæ“ä½œ -->
<p>å…± {{len .Items}} é¡¹</p>
{{range .Items}}
    <li>{{.Name}}</li>
{{end}}
```

## ğŸ”„ é™çº§æœºåˆ¶

ä¸ºç¡®ä¿å…¼å®¹æ€§ï¼Œå®ç°äº†å¤šå±‚é™çº§æœºåˆ¶ï¼š

1. **ä¼˜å…ˆçº§1**: å¢å¼ºæ¨¡æ¿å¼•æ“ (æ”¯æŒæ‰€æœ‰åŠŸèƒ½)
2. **ä¼˜å…ˆçº§2**: æ ‡å‡†æ¨¡æ¿å¼•æ“ (åŸºç¡€åŠŸèƒ½)
3. **ä¼˜å…ˆçº§3**: åŸºç¡€æ¨¡æ¿æ¸²æŸ“ (æœ€å°åŠŸèƒ½é›†)

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åœ¨æ§åˆ¶å™¨ä¸­
```go
func (c *HomeController) GetRouting() {
    c.SetData("Title", "è·¯ç”±æ–‡æ¡£")
    c.SetData("CurrentDoc", "routing")
    
    // ç°åœ¨æ”¯æŒæ‰€æœ‰æ¨¡æ¿å‡½æ•°å’Œå­æ¨¡æ¿å¼•ç”¨
    c.RenderHTML("home/docs/routing.html")
}
```

### è°ƒè¯•æ¨¡æ¿å‡½æ•°
```go
func (c *HomeController) DebugTemplate() {
    // å¯ç”¨æ¨¡æ¿å‡½æ•°è°ƒè¯•
    c.EnableTemplateFunctionDebugging()
    
    // è·å–æ‰€æœ‰å¯ç”¨å‡½æ•°
    functions := c.ListBeegoTemplateFunctions()
    
    // æµ‹è¯•å‡½æ•°æ˜¯å¦æ­£å¸¸
    working := c.TestBeegoTemplateFunctions()
    
    c.SetData("Functions", functions)
    c.SetData("Working", working)
    c.RenderHTML("debug/template-functions.html")
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

1. **æ¨¡æ¿ç¼“å­˜**: è‡ªåŠ¨ç¼“å­˜ç¼–è¯‘åçš„æ¨¡æ¿
2. **å»¶è¿Ÿåˆå§‹åŒ–**: åªåœ¨éœ€è¦æ—¶åˆå§‹åŒ–å¢å¼ºå¼•æ“
3. **å‡½æ•°å¤ç”¨**: å…±äº«æ¨¡æ¿å‡½æ•°å®šä¹‰
4. **é”™è¯¯æ¢å¤**: å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°åŸºç¡€å¼•æ“

## ğŸ¯ æµ‹è¯•éªŒè¯

è¿è¡Œ `test_template_fix.go` æ¥éªŒè¯ä¿®å¤æ•ˆæœï¼š

```bash
cd example/simple
go run test_template_fix.go
```

è®¿é—® `http://localhost:8888/home/routing` åº”è¯¥å¯ä»¥çœ‹åˆ°ï¼š
- âœ… æ­£å¸¸æ˜¾ç¤ºä¾§è¾¹æ å¯¼èˆª
- âœ… æ‰€æœ‰æ¨¡æ¿å‡½æ•°æ­£å¸¸å·¥ä½œ
- âœ… å­æ¨¡æ¿æ­£ç¡®åŠ è½½

## ğŸ“ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼ŒYYHertz æ¡†æ¶ç°åœ¨å…·å¤‡äº†ï¼š

1. **å®Œæ•´çš„ Beego å…¼å®¹æ€§** - æ”¯æŒæ‰€æœ‰å¸¸ç”¨æ¨¡æ¿å‡½æ•°
2. **å¼ºå¤§çš„æ¨¡æ¿å¼•ç”¨** - æ”¯æŒ `{{template}}` å‡½æ•°
3. **ä¼˜é›…çš„é™çº§æœºåˆ¶** - ç¡®ä¿å‘åå…¼å®¹
4. **ä¸°å¯Œçš„è°ƒè¯•å·¥å…·** - ä¾¿äºå¼€å‘å’Œè°ƒè¯•
5. **é«˜æ€§èƒ½æ¸²æŸ“** - ç¼“å­˜å’Œä¼˜åŒ–æœºåˆ¶

ç°åœ¨å¼€å‘è€…å¯ä»¥åƒä½¿ç”¨ Beego ä¸€æ ·è½»æ¾åœ°ä½¿ç”¨å„ç§æ¨¡æ¿å‡½æ•°ï¼Œå¤§å¤§æå‡äº†å¼€å‘æ•ˆç‡å’Œæ¨¡æ¿çš„è¡¨è¾¾èƒ½åŠ›ã€‚
